---
title: "Using the Student and School Data" 
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{learningtower_school}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
echo = TRUE,
collapse = TRUE,
comment = "#>",
warning = FALSE,
message = FALSE,
error = FALSE,
outwidth = "100%",
fig.width = 8,
fig.height = 6,
fig.align = "center")
```

# Introduction

The goal of `learningtower` is to provide a user-friendly R package to provide easy access to a subset of variables from PISA data collected from the [OECD](http://www.oecd.org/pisa/data/), for years 2000-2018, collected on a three year basis.

You can explore more on this datasets for various analysis and statistical computations.

This vignette documents how to access these datasets, and shows a few typical methods to explore the data.

# Using the Student and School Data

## Using the student subset data and school data

```{r}
library(tidyverse)
library(learningtower)

#loading the student subset data 
data(student_subset_2018)

#loading the school data
data(school)

#loading the country data
data(countrycode)


#joining the student, school datasets
school_student_subset_2018 <- left_join(student_subset_2018, 
                                        school, 
                                        by = "school_id") 

#check the count of public and private schools in the a few randomly selected countries
school_student_subset_2018 %>% 
    dplyr::filter(country.x %in% c("AUS", "QAT", "USA" , "JPN", 
                               "ALB", "PER", "FIN",  "SGP")) %>%
  group_by(country.x, public_private) %>% 
  count() %>% 
  mutate(country = fct_reorder(country.x, n)) %>% 
  left_join(countrycode, by = "country") %>% 
#joining the data with countrycode to fetch the country names
  na.omit() %>% 
  ggplot(aes(y = public_private,
             x = n,
             fill = public_private)) +
  geom_bar(stat="identity", alpha=.63, width=.45, position = "dodge") +
  facet_wrap(~country_name, ncol = 2) +
  theme(legend.position = "none") +
  labs(title = "Distribution of public and private schools in the year 2018", 
       y = "",
       x = "Count of schools")
```

- The graph assists us in understanding the distribution of public and private schools in few countries based on the datasets. Taking a closer look at the above plot, we can infer that most countries have more public schools than private schools. Interestingly, Australia had a nearly equal mix of public and private schools in the year 2018.

- Similarly, we may derive additional intriguing patterns and analysis by considering the other variables in the school dataset.

```{r, echo= FALSE}
student_data_2018 <- load_student("2018")

data(school)
data(countrycode)

school_student_2018 <- left_join(student_data_2018, 
                                        school, 
                                        by = "school_id")

school_student_2018 %>%
  dplyr::filter(country.x %in% c("AUS", "QAT", "USA" , "JPN", 
                               "ALB", "PER", "FIN",  "SGP")) %>% 
  group_by(country.x) %>% 
  summarise(avg_fund_gov = mean(fund_gov, na.rm = TRUE)) %>% 
  arrange(avg_fund_gov) %>% 
  mutate(country = fct_reorder(country.x, avg_fund_gov)) %>% 
  left_join(countrycode, by = "country") %>% 
  dplyr::select(country_name, avg_fund_gov) %>% 
  mutate(country_name = factor(country_name, 
                               levels = c("Peru", "Qatar", "Albania", "Japan", 
                                          "Australia", "Singapore", "United States", "Finland"))) %>% 
  ggplot(aes(x=country_name, y=avg_fund_gov)) +
  geom_segment(aes(xend=country_name, yend=0)) +
  geom_point( size=4, color="orange") +
  coord_flip() +
  theme_bw() +
  labs(x = "", 
       y = "Average percentage of government funding", 
       title = "Funding for schools in the year 2018 from government")
```

- The above figure shows the average percentage of overall financing in various schools for a random sample of countries. We conclude that countries such as Finland and the United States received the most funding from their governments, whilst Qatar received the least funding.

- In addition, to perform  a detail analysis on the school and entire student data it can be downloaded for the desired years using the `load_student` function available in this package. 

- Similarly, you may import student data for any chosen year and experiment with PISA scores growth or additional analysis of these datasets with their other elements that assist contributor comprehend the data. Refer to our articles [here](https://kevinwang09.github.io/learningtower/articles/exploring_time.html) for additional interesting analyses and plots.


